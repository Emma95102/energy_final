<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>çç‰Œç´€éŒ„ - ç¯€èƒ½ç¿’æ…£è¿½è¹¤å™¨</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header>
    <h1>ç¯€èƒ½ç¿’æ…£è¿½è¹¤å™¨</h1>
    <p class="subtitle">å°ç¿’æ…£å¸¶ä¾†å¤§å½±éŸ¿ â€” SDGs 7 / 11 / 13</p>

    <nav>
      <a href="home.html"><button>ğŸ  é¦–é </button></a>
      <a href="behavior.html"><button>ğŸ“‹ è¡Œç‚ºè¡¨</button></a>
      <a href="history.html"><button>ğŸ“˜ æ­·å²ç´€éŒ„</button></a>
      <a href="medals.html"><button>ğŸ… çç‰Œç´€éŒ„</button></a>
    </nav>
  </header>

  <main class="page">
    <section class="card">
      <h2>çç‰Œç´€éŒ„</h2>
      <p>æ¯é€±é”æˆ <strong>100 é»</strong> å³å¯ç²å¾— 1 é¢çç‰Œï¼</p>
      <div id="medal-count" style="font-size:22px;margin:10px 0;"></div>
      <hr>
      <div id="medal-list"></div>
    </section>
  </main>

  <!-- ä½¿ç”¨ä½ çš„æœ¬æ©Ÿè³‡æ–™ main.js -->
  <script src="main.js"></script>

  <!-- å°ˆå±¬çç‰Œé‚è¼¯ï¼ˆç´”å‰ç«¯ï¼Œä¸ä½¿ç”¨ Firebaseï¼‰ -->
  <script>
    // è®€å– storeï¼ˆmain.js è£¡ç”Ÿæˆï¼‰
    const medalListEl = document.getElementById("medal-list");
    const medalCountEl = document.getElementById("medal-count");

    // è‹¥ store ä¸å­˜åœ¨ï¼Œå…ˆå»ºç«‹é¿å…å ±éŒ¯
    if (!window.store) {
      window.store = { medals: [], weeklyTotal: 0 };
    }

    const store = window.store;

    // ===========================
    //   è‡ªå‹•åˆ¤æ–·æ˜¯å¦è¦æ–°å¢çç‰Œ
    // ===========================
    function checkAddMedal() {
      // è‹¥æœ¬é€±é»æ•¸ >=100 ä¸”è©²é€±é‚„æ²’é ˜éçç‰Œ â†’ æ–°å¢
      if (store.weeklyTotal >= 100) {

        // åˆ¤æ–·æ˜¯ä¸æ˜¯ã€Œæœ¬é€±ã€å·²ç¶“é ˜éçç‰Œ
        const thisWeek = getWeekString();
        const already = store.medals.some(m => m.week === thisWeek);

        if (!already) {
          store.medals.push({
            week: thisWeek,
            date: new Date().toISOString().split("T")[0]
          });

          saveStore();
        }
      }
    }

    // ===========================
    //   é¡¯ç¤ºçç‰Œå…§å®¹
    // ===========================
    function renderMedals() {
      const medals = store.medals || [];

      medalCountEl.textContent = `ç›®å‰å…±æœ‰ï¼š${medals.length} é¢çç‰Œ ğŸ…`;

      if (medals.length === 0) {
        medalListEl.innerHTML = "<p class='muted'>å°šç„¡çç‰Œç´€éŒ„ï¼ŒåŠ æ²¹ï¼</p>";
        return;
      }

      let html = "";
      medals.forEach((m, idx) => {
        html += `
          <div class="history-item">
            <div class="date">ğŸ… ç¬¬ ${idx + 1} é¢çç‰Œ</div>
            <div class="muted">é€±æ¬¡ï¼š${m.week}</div>
            <div class="muted">å–å¾—æ—¥æœŸï¼š${m.date}</div>
            <hr>
          </div>
        `;
      });

      medalListEl.innerHTML = html;
    }

    // ===========================
    //   è¼”åŠ©å‡½æ•¸ï¼šå–å¾—ã€Œä»Šå¹´ç¬¬å¹¾é€±ã€
    // ===========================
    function getWeekString() {
      const d = new Date();
      const oneJan = new Date(d.getFullYear(), 0, 1);
      const numberOfDays = Math.floor((d - oneJan) / (24 * 60 * 60 * 1000));
      const week = Math.ceil((d.getDay() + 1 + numberOfDays) / 7);
      return `${d.getFullYear()}-W${week}`;
    }

    // ===========================
    //   åˆå§‹åŒ–
    // ===========================
    checkAddMedal();
    renderMedals();
  </script>
</body>
</html>
